2016-12-28



# 12 新規作成フォームを作ろう

http://localhost:3000/rails/info/routes/ でルーティングの確認ができる。

まず /app/views/projects/index.html.erb に、新規登録画面に飛ぶリンクを作る。

  <p><%= link_to "Add New", new_project_path %></p>

次にコントローラを作る。/app/controllers/projects_controller.rb に以下を追加。

  # NewAction
  def new
    @project = Project.new
  end

次に対応する View で Form を作る。/app/views/projects/new.html.erb を作り以下のようにコーディング。

  <%# Controller の #new で指定したインスタンス変数 @project を使った Form %>
  <%= form_for @project do |f| %>
    <%# ラベルとテキストボックス %>
    <p>
      <%= f.label :title %><br>
      <%= f.text_field :title %>
    </p>
    <%# Submit ボタン %>
    <p>
      <%= f.submit %>
    </p>
  <% end %>

これで http://localhost:3000/projects/new ページができた。



# 13 データを保存してみよう

POST で #create する処理を作る。

/app/controllers/projects_controller.rb に以下を追加。

  # CreateAction
  def create
    # Form から情報を取得する。project_params はプライベート関数
    @project = Project.new(project_params)
    # DB に保存する
    @project.save
    # redirect_to に Path を付けることでリダイレクトする
    redirect_to projects_path
  end
  
  # プライベート宣言
  private
    # Create 用のパラメータを扱うプライベート関数
    def project_params
      # params 中の project の中にある title の受取を許可する
      params[:project].permit(:title)
    end

private 宣言以降はプライベートな関数になる。

project_params 関数は HTTP リクエスト中の特定のパラメータのみ受け取ることを許可する書き方。
StrongParameters という仕組みらしい。
https://www.transnet.ne.jp/2016/05/18/rails%E5%88%9D%E5%AD%A6%E8%80%85%E3%82%B9%E3%83%88%E3%83%AD%E3%83%B3%E3%82%B0%E3%83%91%E3%83%A9%E3%83%A1%E3%83%BC%E3%82%BF%E3%83%BCcolnr/